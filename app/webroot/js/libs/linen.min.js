var linen=function(){function h(a){function b(a){function j(a){function b(a){var c="<"+a[0].type+g(a[0])+">";for(var d in a){var e=a[d];e.type?(c+="<li>"+e.content,a[d+1]&&a[d+1].type==undefined&&(c+=b(a[++d])),c+="</li>"):c+=b(e)}return c+="</"+a[0].type+">"}return b(a.content)}function i(a){var b="<table"+g(a)+">";for(var c in a.content){var d=a.content[c];b+="<tr>";for(var e in d)b+="<td>"+d[e]+"</td>";b+="</tr>"}return b+="</table>"}function h(a){return"<pre"+g(a)+">"+a.content+"</pre>"}function f(a){return"<pre"+g(a)+"><code>"+a.content+"</code></pre>"}function e(a){return"<p"+g(a)+">"+a.content+"</p>"}function d(a){return"<p"+g(a)+"><sup>"+a.number+"</sup>"+a.content+"</p>"}function c(a){return"<blockquote"+g(a)+"><p>"+a.content+"</p></blockquote>"}function b(a){return"<"+a.type+g(a)+">"+a.content+"</"+a.type+">"}switch(a.type){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return b(a);case"bq":return c(a);case"fn":return d(a);case"p":return e(a);case"bc":return f(a);case"pre":return h(a);case"table":return i(a);case"ul":case"ol":return j(a)}}ret="";for(var c in a)ret+=b(a[c])+"\n";return ret}function g(a){var b=" ",c=a.attrs;c.classes&&(b+='class="'+c.classes+'" '),c.id&&(b+='id="'+c.id+'" '),c.align&&(c.style="text-align: "+c.align+"; "+c.style),c.style&&(b+='style="'+c.style+'" '),c.lang&&(b+='lang="'+c.lang+'" ');return b.slice(0,b.length-1)}function f(a){var b={classes:"",id:"",lang:"",style:"",alignment:""};for(var c in a){var d=a[c];if(d[0]=="("){var e=d.replace(/^\(/,"").replace(/\)$/,"").split("#");b.classes==""?b.classes=e[0]:b.classes=b.classes+" "+e[0],e.length>1&&b.id==""&&(b.id=e[1])}else d[0]=="["?b.lang=d.replace(/^\[/,"").replace(/\]$/,""):d[0]=="{"?b.style=d.replace(/^\{/,"").replace(/\}$/,""):b.alignment==""&&(d==">"&&(b.alignment="right"),d=="<"&&(b.alignment="left"),d=="="&&(b.alignment="center"),d=="<>"&&(b.alignment="justify"))}return b}function e(a){function g(a){var g;a.type=="ol"||a.type=="ul"?g=b(a):a.type=="table"?g=e(a):a.type=="bc"?g={type:a.type,content:c(a.content),attrs:f(a.attrs)}:g={type:a.type,content:d(a.content),attrs:f(a.attrs)};return g}function e(a){return{type:"table",attrs:f(a.attrs),content:a.content,classes:"",id:"",lang:"",style:"",alignment:""}}function b(a){for(var b=a.content,c=1,e=[],g=e,h=[],i=0;i<b.length;i++){var j=b[i];j.content=d(j.content),j.attrs=f(j.attrs);if(j.indent>c)for(var k=0;k<j.indent-c;k++){h.push(g);var l=[];g.push(l),g=l}if(j.indent<c)for(var k=0;k<c-j.indent;k++)g=h.pop();g.push(j),c=j.indent}return{type:a.type,content:e,attrs:e[0].attrs,classes:"",id:"",lang:"",style:"",alignment:""}}var h=[];for(var i in a)h.push(g(a[i]));return h}function d(a){function e(a,b){typeof b=="undefined"&&(b=1);return a.slice(b,a.length-b)}function d(a,b){return b[b.length-1]=="."?c("a",a,'href="'+b.slice(0,b.length-1)+'"')+".":c("a",a,'href="'+b+'"')}function c(a,c,d){typeof d=="undefined"?d="":d=" "+d;var e=b(c),h=f(e.attrs);return"<"+a+g({attrs:h})+d+">"+e.content+"</"+a+">"}return a.replace(/(\s)"(.*?)"([^:])/g,"$1&#8220;$2&#8221;$3").replace(/"([^"]+)":(http\S+)/g,function(a,b,c){return d(b,c)}).replace(/!\b([^! \n]+)\b!:(http\S+)/g,function(a,b,d){return c("a"," "+c("img","",'src="'+b+'"'),'href="'+d+'"')}).replace(/!([^! \n]+)!/g,function(a){return c("img","",'src="'+e(a)+'"')}).replace(/--/g,"&#8212;").replace(/\n/g,"<br/>").replace(/(\b)'([^']*)'(\b)/g,"$1&#8216;$2&#8217;$3").replace(/'/g,"&#8217;").replace(/ - /g," &#8211; ").replace(/\.\.\./g,"&#8230;").replace(/\(r\)/g,"&#174;").replace(/\(tm\)/g,"&#8482;").replace(/\(c\)/g,"&#169;").replace(/([A-Z]{2,})\(([^)]+)\)/g,'<span class="caps"><acronym title="$2">$1</acronym></span>').replace(/([A-Z]{2,})/g,function(a){return c("span",a+" ",'class="caps"')}).replace(/\?{2}([^\?]+)\?{2}/g,function(a){return c("cite",e(a))}).replace(/%([^%]+)%/g,function(a){return c("span",e(a))}).replace(/(@[^@]+@)/g,function(a){return c("code",e(a))}).replace(/\*([^\*]+)\*/g,function(a){return c("strong",e(a))}).replace(/\*\*([^\*]+)\*\*/g,function(a){return c("b",e(a))}).replace(/\b_([^_]+)_\b/g,function(a){return c("em",e(a))}).replace(/\b__([^_]+)__\b/g,function(a){return c("i",e(a))}).replace(/\s\+([^\+]+)\+\s/g,function(a){return" "+c("ins",e(a,2))+" "}).replace(/\s-([^-]+)-\s/g,function(a){return" "+c("del",e(a,2))+" "}).replace(/\^([^\^]+)\^/g,function(a){return c("sup",e(a))}).replace(/~([^~]+)~/g,function(a){return c("sub",e(a))})}function c(a){return a.replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/"/g,"&#34;")}function b(a){for(var b=[],c=a.match(/^<\S+[^<>]*>/)!==null,d=0;d<a.length;d++){var e=a[d];if(e==">")b.push(">");else if(e=="=")b.push("=");else if(e!="<"||c)if(e=="("){var f=d;while(a[d++]!==")"&&d<a.length)continue;b.push(a.slice(f,d--))}else if(e=="["){var f=d;while(a[d++]!=="]"&&d<a.length)continue;b.push(a.slice(f,d--))}else{if(e!="{")break;var f=d;while(a[d++]!=="}"&&d<a.length)continue;b.push(a.slice(f,d--))}else a[d+1]==">"?(++d,b.push("<>")):b.push("<")}return{attrs:b,content:a.slice(d,a.length)}}function a(a){function e(a){function l(a){var b=["h1","h2","h3","h4","h5","h6","pre","bq","fn","p","bc","pre","table","ul","ol"];for(var c in b)if(b[c]==a)return!0;return!1}var e=[],f="",g=0,h=a[0];h=="f"&&a[g+1]=="n"&&(f="fn",++g);if(h=="*"||h=="#"){var i=b(a.slice(1));if(/^\s+/.exec(i.content))return c(a)}if(h=="|")return d(a);h=="b"&&(f="b"+a[++g]),h=="h"&&(f="h"+a[++g]),h=="p"&&(a.slice(g,g+3)=="pre"?(g+=2,f="pre"):f="p"),++g;var j=b(a.slice(g,a.length)),k=/^(\.+ )/.exec(j.content);k&&l(f)?(j.type=f,j.content=j.content.replace(/^(\.+ )/,""),j.extended=k[1]==".. ",j.noBlock=!1):(j.type="p",j.content=a,j.extended=!1,j.noBlock=!0);return j}function d(a){var c=a.split("\n"),d=[],e;for(var f in c){var g=c[f].replace(/^\|/,"").replace(/\|$/,""),h=b(g[0]);g[0]=h.content,f==0&&(e=h.attrs),d.push(g.split("|"))}return{type:"table",extended:!1,attrs:e,content:d}}function c(a){function c(a){var c=a.split("\n"),d=[];for(var e in c){var f=/^(\*+|#+)(.*)/.exec(c[e]);if(f){types={"*":"ul","#":"ol"};var g=b(f[2]);d.push({type:types[f[1][0]],indent:f[1].length,content:g.content,attrs:g.attrs})}}return d}var d=c(a);return{type:d[0].type,extended:!1,attrs:[],content:d}}var f=a.split(/\n\n+/),g=[];for(var h in f){var i=e(f[h]);i&&g.push(i)}return g}return function(b){return h(e(a(b)))}}();typeof exports!="undefined"&&(exports.textilize=exports.linen=linen);
